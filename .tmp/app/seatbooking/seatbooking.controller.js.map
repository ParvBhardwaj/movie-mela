{"version":3,"sources":["app/seatbooking/seatbooking.controller.js"],"names":["SeatbookingComponent","$http","$scope","socket","$rootScope","$location","_this","SeatData","bookedSeat","book2pay","angular","merge","run2book","selectedSeats","intCharg","$on","unsyncUpdates","uurl","date","time","cine","movie","get","then","response","data","syncUpdates","console","log","seats","document","getElementsByClassName","i","length","sx","id","findBooked","indexOf","style","catch","error","$event","elem","currentTarget","srcElement","found","splice","push","showSelectedSeats","join","calcTotal","total","s","row","substring","path","module","component","templateUrl","controller","controllerAs"],"mappings":"AAAA;;;;;;AAEA,CAAC,YAAY;AAAA,MACLA,oBADK;AAET,kCAAYC,KAAZ,EAAmBC,MAAnB,EAA2BC,MAA3B,EAAmCC,UAAnC,EAA+CC,SAA/C,EAA0D;AAAA;;AACxD,UAAIC,QAAQ,IAAZ;AACA,WAAKL,KAAL,GAAaA,KAAb;AACA,WAAKE,MAAL,GAAcA,MAAd;AACA,WAAKD,MAAL,GAAcA,MAAd;AACA,WAAKE,UAAL,GAAkBA,UAAlB;AACA,WAAKC,SAAL,GAAiBA,SAAjB;;AAEA,WAAKE,QAAL,GAAgB,EAAhB;AACA,WAAKC,UAAL,GAAkB,EAAlB;AACA,WAAKC,QAAL,GAAgB,EAAhB;AACAC,cAAQC,KAAR,CAAc,KAAKF,QAAnB,EAA6BL,WAAWQ,QAAxC;;AAEA,WAAKC,aAAL,GAAqB,EAArB;AACA,WAAKC,QAAL,GAAgB,EAAhB;AACAZ,aAAOa,GAAP,CAAW,UAAX,EAAuB,YAAY;AACjCZ,eAAOa,aAAP,CAAqB,aAArB;AACD,OAFD;AAID,KArBQ,CAqBR;;AArBQ;AAAA;AAAA,gCAuBC;AAAA;;AACR,YAAIC,OAAO,8BAA8B,KAAKR,QAAL,CAAcS,IAA5C,GACT,GADS,GACH,KAAKT,QAAL,CAAcU,IADX,GACkB,GADlB,GACwB,KAAKV,QAAL,CAAcW,IADtC,GAET,GAFS,GAEH,KAAKX,QAAL,CAAcY,KAFtB;;AAIA,aAAKpB,KAAL,CAAWqB,GAAX,CAAeL,IAAf,EACGM,IADH,CACQ,oBAAY;AAChB,iBAAKf,UAAL,GAAkB,EAAlB;AACA,iBAAKA,UAAL,CAAgBK,aAAhB,GAAgC,EAAhC;AACA;;AAEA,iBAAKL,UAAL,GAAkBgB,SAASC,IAA3B;AACA,iBAAKtB,MAAL,CAAYuB,WAAZ,CAAwB,cAAxB,EAAwC,OAAKlB,UAA7C;AACAmB,kBAAQC,GAAR,CAAYJ,SAASC,IAArB;;AAEA,cAAII,QAAQC,SAASC,sBAAT,CAAgC,QAAhC,CAAZ;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,MAAMI,MAA1B,EAAkCD,GAAlC,EAAuC;AACrC,gBAAIE,KAAKL,MAAMG,CAAN,CAAT;AACA,gBAAIG,KAAKD,GAAGC,EAAZ;;AAEA,gBAAIC,aAAa,OAAK5B,UAAL,CAAgBK,aAAhB,CAA8BwB,OAA9B,CAAsCF,EAAtC,CAAjB;AACA,gBAAIC,aAAa,CAAC,CAAlB,EACEF,GAAGI,KAAH,GAAW,uBAAX;AACH;AACF,SAnBH,EAmBKC,KAnBL,CAmBW,UAAUC,KAAV,EAAiB;AACxBb,kBAAQC,GAAR,CAAY,iBAAZ,EAA+BY,KAA/B;AACD,SArBH;AAsBA;AAED,OApDQ,CAoDR;AACD;;;AArDS;AAAA;AAAA,6BAwDFC,MAxDE,EAwDM;AACb,YAAIC,OAAOD,OAAOE,aAAP,IAAwBF,OAAOG,UAA1C;AACA,YAAIT,KAAKO,KAAKP,EAAd;;AAEA;AACA;AACA;AACA,YAAI,OAAO,KAAK3B,UAAZ,KAA2B,WAA/B,EAA4C,KAAKA,UAAL,GAAkB,EAAlB;;AAE5C,YAAI,OAAO,KAAKA,UAAL,CAAgBK,aAAvB,KAAyC,WAA7C,EAA0D,KAAKL,UAAL,CAAgBK,aAAhB,GAAgC,EAAhC;;AAE1D,YAAIuB,aAAa,KAAK5B,UAAL,CAAgBK,aAAhB,CAA8BwB,OAA9B,CAAsCF,EAAtC,CAAjB;AACA,YAAIC,aAAa,CAAC,CAAlB,EAAqB;AACrB;AACA,YAAIS,QAAQ,KAAKhC,aAAL,CAAmBwB,OAAnB,CAA2BF,EAA3B,CAAZ;AACA,YAAIU,QAAQ,CAAC,CAAb,EAAgB;AACdH,eAAKJ,KAAL,GAAa,EAAb;AACA,eAAKzB,aAAL,CAAmBiC,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACD,SAHD,MAIK;AACHH,eAAKJ,KAAL,GAAa,2BAAb;AACA,eAAKzB,aAAL,CAAmBkC,IAAnB,CAAwBZ,EAAxB;AACD;;AAEDR,gBAAQC,GAAR,CAAY,KAAKf,aAAjB;AACA,aAAKmC,iBAAL,GAAyB,KAAKnC,aAAL,CAAmBoC,IAAnB,CAAwB,IAAxB,CAAzB;AACA,aAAKC,SAAL;AACD;AAnFQ;AAAA;AAAA,kCAsFG;AACV,YAAIC,QAAQ,KAAKrC,QAAjB;AACA,aAAK,IAAIsC,IAAI,CAAb,EAAgBA,IAAI,KAAKvC,aAAL,CAAmBoB,MAAvC,EAA+CmB,GAA/C,EAAoD;AAClD,cAAIC,MAAM,KAAKxC,aAAL,CAAmBuC,CAAnB,EAAsBE,SAAtB,CAAgC,CAAhC,EAAmC,CAAnC,CAAV;AACA,cAAID,OAAO,GAAP,IAAcA,OAAO,GAArB,IAA4BA,OAAO,GAAvC,EACEF,SAAS,GAAT,CADF,KAEK,IAAIE,OAAO,GAAP,IAAcA,OAAO,GAArB,IAA4BA,OAAO,GAAnC,IAA0CA,OAAO,GAAjD,IAAwDA,OAAO,GAAnE,EACHF,SAAS,GAAT,CADG,KAEA,IAAIE,OAAO,GAAP,IAAcA,OAAO,GAArB,IAA4BA,OAAO,GAAnC,IAA0CA,OAAO,GAArD,EACHF,SAAS,GAAT;AACH;AACD,aAAKA,KAAL,GAAaA,KAAb;AACD;AAlGQ;AAAA;AAAA,kCAoGG;;AAEV,aAAK/C,UAAL,CAAgBK,QAAhB,GAA2BC,QAAQC,KAAR,CAAc,EAAd,EAAkB,KAAKF,QAAvB,CAA3B;AACA,aAAKL,UAAL,CAAgBK,QAAhB,CAAyBI,aAAzB,GAAyC,KAAKA,aAA9C;AACA,aAAKT,UAAL,CAAgBK,QAAhB,CAAyB0C,KAAzB,GAAiC,KAAKA,KAAtC;AACA,aAAK/C,UAAL,CAAgBK,QAAhB,CAAyBK,QAAzB,GAAoC,KAAKA,QAAzC;;AAEA;;AAEA,aAAKT,SAAL,CAAekD,IAAf,CAAoB,UAApB;AACD;AA9GQ;;AAAA;AAAA,OA+GV;;;AAGD7C,UAAQ8C,MAAR,CAAe,cAAf,EACGC,SADH,CACa,aADb,EAC4B;AACxBC,iBAAa,kCADW;AAExBC,gBAAY3D,oBAFY;AAGxB4D,kBAAc;AAHU,GAD5B;AAOD,CAzHD","file":"seatbooking.controller.js","sourcesContent":["'use strict';\r\n\r\n(function () {\r\n  class SeatbookingComponent {\r\n    constructor($http, $scope, socket, $rootScope, $location) {\r\n      var _this = this;\r\n      this.$http = $http;\r\n      this.socket = socket;\r\n      this.$scope = $scope;\r\n      this.$rootScope = $rootScope;\r\n      this.$location = $location;\r\n\r\n      this.SeatData = {};\r\n      this.bookedSeat = {};\r\n      this.book2pay = {};\r\n      angular.merge(this.book2pay, $rootScope.run2book);\r\n\r\n      this.selectedSeats = [];\r\n      this.intCharg = 50;\r\n      $scope.$on('$destroy', function () {\r\n        socket.unsyncUpdates('seatbooking');\r\n      });\r\n\r\n    }// end constructor\r\n\r\n    $onInit() {\r\n      var uurl = '/api/seatbookings/booked/' + this.book2pay.date +\r\n        '/' + this.book2pay.time + '/' + this.book2pay.cine +\r\n        '/' + this.book2pay.movie;\r\n\r\n      this.$http.get(uurl)\r\n        .then(response => {\r\n          this.bookedSeat = {};\r\n          this.bookedSeat.selectedSeats = [];\r\n          //initialize before fetch from database\r\n\r\n          this.bookedSeat = response.data;\r\n          this.socket.syncUpdates('seatbookings', this.bookedSeat);\r\n          console.log(response.data);\r\n\r\n          var seats = document.getElementsByClassName('seatno');\r\n          for (var i = 0; i < seats.length; i++) {\r\n            var sx = seats[i];\r\n            var id = sx.id;\r\n\r\n            var findBooked = this.bookedSeat.selectedSeats.indexOf(id);\r\n            if (findBooked > -1)\r\n              sx.style = 'background-color:red;'\r\n          }\r\n        }).catch(function (error) {\r\n          console.log('Error occurred!', error);\r\n        });\r\n      //disable booked  seats\r\n\r\n    }//end on init\r\n    //ng-disabled=\"$ctrl.seatVisibleBar(row,$index)\"\r\n\r\n\r\n    sClick($event) {\r\n      var elem = $event.currentTarget || $event.srcElement;\r\n      var id = elem.id;\r\n\r\n      //two task \r\n      // get find if the clicked seat is in booked seats (onInit)\r\n      //return; and exit this function\r\n      if (typeof this.bookedSeat === 'undefined') this.bookedSeat = {};\r\n\r\n      if (typeof this.bookedSeat.selectedSeats === 'undefined') this.bookedSeat.selectedSeats = [];\r\n\r\n      var findBooked = this.bookedSeat.selectedSeats.indexOf(id);\r\n      if (findBooked > -1) return;\r\n      debugger;\r\n      var found = this.selectedSeats.indexOf(id);\r\n      if (found > -1) {\r\n        elem.style = '';\r\n        this.selectedSeats.splice(found, 1);\r\n      }\r\n      else {\r\n        elem.style = 'background-color:#96FF33;';\r\n        this.selectedSeats.push(id);\r\n      }\r\n\r\n      console.log(this.selectedSeats);\r\n      this.showSelectedSeats = this.selectedSeats.join(', ');\r\n      this.calcTotal();\r\n    }\r\n\r\n\r\n    calcTotal() {\r\n      var total = this.intCharg;\r\n      for (var s = 0; s < this.selectedSeats.length; s++) {\r\n        var row = this.selectedSeats[s].substring(0, 1);\r\n        if (row == 'A' || row == 'B' || row == 'C')\r\n          total += 300;\r\n        else if (row == 'D' || row == 'E' || row == 'F' || row == 'G' || row == 'H')\r\n          total += 250;\r\n        else if (row == 'I' || row == 'J' || row == 'K' || row == 'L')\r\n          total += 200;\r\n      }\r\n      this.total = total;\r\n    }\r\n\r\n    goPayment() {\r\n\r\n      this.$rootScope.book2pay = angular.merge({}, this.book2pay);\r\n      this.$rootScope.book2pay.selectedSeats = this.selectedSeats;\r\n      this.$rootScope.book2pay.total = this.total;\r\n      this.$rootScope.book2pay.intCharg = this.intCharg;\r\n\r\n      // add more fields in book2pay from this\r\n\r\n      this.$location.path('/payment');\r\n    }\r\n  }// end class\r\n\r\n\r\n  angular.module('movieMelaApp')\r\n    .component('seatbooking', {\r\n      templateUrl: 'app/seatbooking/seatbooking.html',\r\n      controller: SeatbookingComponent,\r\n      controllerAs: 'seatbookingCtrl'\r\n    });\r\n\r\n})();\r\n\r\n"]}